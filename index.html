<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trader Calculator PRO - Ultimate Edition</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Ajuste rápido para los selectores que se veían blancos */
        select {
            background: rgba(0, 0, 0, 0.5);
            color: #fff;
            border: 1px solid #00d4ff;
            border-radius: 5px;
            padding: 5px;
        }
        .row-group {
            border: 1px solid rgba(255,255,255,0.1);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
<div class="app">
    <header class="top">
        <div class="brand">TRADER PRO</div>
        <div class="sub">Gestión de Riesgo & Rendimiento Profesional</div>
    </header>

    <main class="card">
        <section class="inputs">
            <div class="row-group">
                <div class="row">
                    <div class="left"><div class="lbl">Capital & Moneda</div></div>
                    <div class="right">
                        <select id="moneda">
                            <option value="EUR">€ EUR</option>
                            <option value="USD">$ USD</option>
                            <option value="GBP">£ GBP</option>
                        </select>
                        <input id="capital" type="number" placeholder="10000">
                    </div>
                </div>
                <div class="row">
                    <div class="left"><div class="lbl">Riesgo por Operación</div></div>
                    <div class="right">
                        <input id="riesgo" type="number" placeholder="1">
                        <span class="unit">%</span>
                    </div>
                </div>
            </div>

            <div class="row-group">
                <div class="row">
                    <div class="left"><div class="lbl">Stop Loss</div></div>
                    <div class="right">
                        <input id="stop" type="number" placeholder="2">
                        <span class="unit">%</span>
                    </div>
                </div>
                <div class="row">
                    <div class="left"><div class="lbl">Trailing Stop</div></div>
                    <div class="right">
                        <input id="trailing" type="number" placeholder="1">
                        <span class="unit">%</span>
                    </div>
                </div>
            </div>

            <div class="row-group">
                <div class="row">
                    <div class="left"><div class="lbl">Take Profit (TP)</div></div>
                    <div class="right">
                        <input id="tp" type="number" placeholder="4">
                        <span class="unit">%</span>
                    </div>
                </div>
                <div class="row">
                    <div class="left"><div class="lbl">Comisión Bróker</div></div>
                    <div class="right">
                        <input id="comision" type="number" placeholder="0.1" step="0.01">
                        <span class="unit">%</span>
                    </div>
                </div>
            </div>

            <button id="calcular" class="cta">CALCULAR ANÁLISIS PRO</button>
            <div id="error" class="error"></div>
        </section>

        <section class="results">
            <div class="resultCard neonBlue">
                <div class="rLeft"><div class="rTitle">POSITION & LEVERAGE</div><div class="rSub">Posición | Apalancamiento</div></div>
                <div class="rValue"><span id="posicionOut">—</span><span class="sym">€</span> | x<span id="levOut">1</span></div>
            </div>

            <div class="resultCard neonGreen">
                <div class="rLeft"><div class="rTitle">NET PROFIT (TP)</div><div class="rSub">Beneficio Neto (tras comisiones)</div></div>
                <div class="rValue"><span id="profitOut">—</span><span class="sym">€</span></div>
            </div>

            <div class="resultCard neonPink">
                <div class="rLeft"><div class="rTitle">RISK & RATIO</div><div class="rSub">Pérdida SL | Ratio R:R</div></div>
                <div class="rValue"><span id="slOut">—</span><span class="sym">€</span> | <span id="rrOut">1:0</span></div>
            </div>

            <div class="resultCard neonBlue">
                <div class="rLeft"><div class="rTitle">MIN. WIN RATE</div><div class="rSub">% de acierto para ser rentable</div></div>
                <div class="rValue"><span id="winRateOut">—</span><span class="unit">%</span></div>
            </div>
        </section>
    </main>

    <script>
        const btn = document.getElementById('calcular');
        const monedaSelect = document.getElementById('moneda');
        const symbols = { EUR: "€", USD: "$", GBP: "£" };

        function calcularTodo() {
            const capital = parseFloat(document.getElementById('capital').value) || 0;
            const riesgoP = parseFloat(document.getElementById('riesgo').value) || 0;
            const stopP = parseFloat(document.getElementById('stop').value) || 0;
            const tpP = parseFloat(document.getElementById('tp').value) || 0;
            const comisionP = parseFloat(document.getElementById('comision').value) || 0;
            const sym = symbols[monedaSelect.value];

            if (capital <= 0 || riesgoP <= 0 || stopP <= 0) {
                document.getElementById('error').innerText = "Rellena Capital, Riesgo y Stop.";
                return;
            }

            // 1. Cálculos de Riesgo y Posición
            const riesgoDinero = capital * (riesgoP / 100);
            const posicion = riesgoDinero / (stopP / 100);
            const apalancamiento = posicion / capital;

            // 2. Cálculos de TP y R:R
            const beneficioBruto = posicion * (tpP / 100);
            const comisionesTotal = (posicion * (comisionP / 100)) * 2; // Entrada y salida
            const beneficioNeto = beneficioBruto - comisionesTotal;
            const ratioRR = tpP / stopP;

            // 3. Win Rate Mínimo (Fórmula: 1 / (1 + Ratio RR))
            const minWinRate = (1 / (1 + ratioRR)) * 100;

            // 4. Renderizar
            const f = (n) => n.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            
            document.getElementById('posicionOut').innerText = f(posicion);
            document.getElementById('levOut').innerText = apalancamiento.toFixed(1);
            document.getElementById('profitOut').innerText = f(beneficioNeto);
            document.getElementById('slOut').innerText = f(riesgoDinero + comisionesTotal); // SL + comisiones
            document.getElementById('rrOut').innerText = `1:${ratioRR.toFixed(1)}`;
            document.getElementById('winRateOut').innerText = minWinRate.toFixed(1);

            document.querySelectorAll('.sym').forEach(el => el.innerText = sym);
            document.getElementById('error').innerText = "";
        }

        btn.addEventListener('click', calcularTodo);
        monedaSelect.addEventListener('change', () => {
            document.querySelectorAll('.sym').forEach(el => el.innerText = symbols[monedaSelect.value]);
        });
    </script>
</div>
</body>
</html>
