<div class="btn-group" style="display: flex; gap: 10px; margin-top: 20px; width: 100%;">
    <button id="reset" type="button" style="flex: 1; background: #222; color: #fff; border: 1px solid #444; border-radius: 12px; cursor: pointer; font-weight: bold; padding: 15px; font-size: 14px;">
        RESET
    </button>
    <button id="calcular" class="cta" type="button" style="flex: 2; margin: 0; padding: 15px; font-size: 16px;">
        CALCULAR ANÁLISIS PRO
    </button>
</div>

<script>
    const btnCalcular = document.getElementById('calcular');
    const btnReset = document.getElementById('reset');
    const errorDiv = document.getElementById('error');
    const monedaSelect = document.getElementById('moneda');
    const levOut = document.getElementById('levOut');
    const symbols = { EUR: "€", USD: "$", GBP: "£" };

    function mostrarError(msj) {
        errorDiv.innerText = msj;
        errorDiv.style.color = "#ff4d4d";
        setTimeout(() => errorDiv.innerText = "", 5000);
    }

    function calcular() {
        const capital = parseFloat(document.getElementById('capital').value);
        const riesgoP = parseFloat(document.getElementById('riesgo').value);
        const stopP = parseFloat(document.getElementById('stop').value);
        const tpP = parseFloat(document.getElementById('tp').value) || 0;
        const comisionP = parseFloat(document.getElementById('comision').value) || 0;
        const sym = symbols[monedaSelect.value];

        if (isNaN(capital) || capital <= 0) return mostrarError("Error: Capital inválido.");
        if (isNaN(riesgoP) || riesgoP <= 0) return mostrarError("Error: Riesgo inválido.");
        if (isNaN(stopP) || stopP <= 0) return mostrarError("Error: Stop Loss obligatorio.");

        const riesgoDinero = capital * (riesgoP / 100);
        const posicion = riesgoDinero / (stopP / 100);
        const apalancamiento = posicion / capital;
        const comisionesTotal = (posicion * (comisionP / 100)) * 2;
        const beneficioNeto = (posicion * (tpP / 100)) - comisionesTotal;
        const ratioRR = tpP / stopP;
        const winRate = (1 / (1 + ratioRR)) * 100;
        const breakEven = (comisionesTotal / posicion) * 100;

        // Lógica de color de Apalancamiento
        levOut.innerText = apalancamiento.toFixed(1);
        if (apalancamiento <= 5) {
            levOut.style.color = "#00ff88"; // Verde neón
        } else if (apalancamiento <= 10) {
            levOut.style.color = "#ffaa00"; // Naranja
        } else {
            levOut.style.color = "#ff4d4d"; // Rojo
        }

        const f = (n) => n.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        
        document.getElementById('posicionOut').innerText = f(posicion);
        document.getElementById('profitOut').innerText = f(beneficioNeto);
        document.getElementById('slOut').innerText = f(riesgoDinero + comisionesTotal);
        document.getElementById('rrOut').innerText = `1:${ratioRR.toFixed(1)}`;
        document.getElementById('winRateOut').innerText = isFinite(winRate) ? winRate.toFixed(1) + "%" : "0%";
        
        // El Break-even lo mostramos con 3 decimales para precisión
        if(document.getElementById('beOut')) document.getElementById('beOut').innerText = breakEven.toFixed(3);
        
        document.querySelectorAll('.sym').forEach(el => el.innerText = sym);
    }

    btnReset.addEventListener('click', () => {
        document.querySelectorAll('input').forEach(input => input.value = "");
        document.getElementById('posicionOut').innerText = "—";
        levOut.innerText = "0";
        levOut.style.color = "white";
        document.getElementById('profitOut').innerText = "—";
        document.getElementById('slOut').innerText = "—";
        document.getElementById('rrOut').innerText = "1:0";
        document.getElementById('winRateOut').innerText = "—%";
        if(document.getElementById('beOut')) document.getElementById('beOut').innerText = "0";
        errorDiv.innerText = "";
    });

    btnCalcular.addEventListener('click', calcular);
    monedaSelect.addEventListener('change', () => {
        document.querySelectorAll('.sym').forEach(el => el.innerText = symbols[monedaSelect.value]);
    });
</script>
